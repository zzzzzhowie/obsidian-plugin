/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var C=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var S=(r,e)=>{for(var t in e)C(r,t,{get:e[t],enumerable:!0})},k=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of I(e))!L.call(r,i)&&i!==t&&C(r,i,{get:()=>e[i],enumerable:!(n=N(e,i))||n.enumerable});return r};var b=r=>k(C({},"__esModule",{value:!0}),r);var H={};S(H,{default:()=>v});module.exports=b(H);var a=require("obsidian");var P={pinnedItems:[],showFolderNotes:!0,showFileCount:!0};var p=require("obsidian"),g=class{constructor(e,t){this.pinnedContainerEl=null;this.initializationAttempts=0;this.MAX_INIT_ATTEMPTS=10;this.mutationObserver=null;this.app=e,this.plugin=t}initialize(){this.app.workspace.onLayoutReady(()=>{this.initializeWithRetry()}),this.plugin.registerEvent(this.app.workspace.on("layout-change",()=>{setTimeout(()=>{(!this.pinnedContainerEl||!this.pinnedContainerEl.isConnected)&&(this.pinnedContainerEl=null,this.initializeWithRetry())},150)})),this.plugin.registerEvent(this.app.workspace.on("active-leaf-change",()=>{setTimeout(()=>{(!this.pinnedContainerEl||!this.pinnedContainerEl.isConnected)&&this.initializeWithRetry()},150)}))}initializeWithRetry(){let e=this.addPinnedItemsToFileExplorer();if(!e&&this.initializationAttempts<this.MAX_INIT_ATTEMPTS){this.initializationAttempts++;let t=Math.min(1e3*Math.pow(1.5,this.initializationAttempts),5e3);setTimeout(()=>{this.initializeWithRetry()},t)}else e&&(this.initializationAttempts=0)}cleanup(){this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.pinnedContainerEl&&(this.pinnedContainerEl.remove(),this.pinnedContainerEl=null)}async pinItem(e){let t={path:e.path,type:e instanceof p.TFolder?"folder":"file",name:e.name};this.plugin.settings.pinnedItems.some(n=>n.path===e.path)||(this.plugin.settings.pinnedItems.push(t),await this.plugin.saveSettings(),this.refreshPinnedItems(),new p.Notice(`Pinned: ${e.name}`))}async unpinItem(e){let t=this.plugin.settings.pinnedItems.find(n=>n.path===e);this.plugin.settings.pinnedItems=this.plugin.settings.pinnedItems.filter(n=>n.path!==e),await this.plugin.saveSettings(),this.refreshPinnedItems(),t&&new p.Notice(`Unpinned: ${t.name}`)}addPinnedItemsToFileExplorer(){try{if(this.pinnedContainerEl&&this.pinnedContainerEl.isConnected)return!0;let e=this.app.workspace.getLeavesOfType("file-explorer");if(!e||e.length===0)return!1;let t=e[0];if(!t||!t.view)return!1;let n=t.view;if(!n.containerEl)return!1;let i=n.containerEl,s=i.querySelector(".nav-files-container");if(!s){let o=i.querySelector(".pinned-items-container");return o&&o.remove(),this.pinnedContainerEl=i.createDiv({cls:"pinned-items-container pinned-items-fallback"}),this.refreshPinnedItems(),!0}s.style.display="",s.style.visibility="",this.pinnedContainerEl&&!this.pinnedContainerEl.isConnected&&(this.pinnedContainerEl=null);let l=i.querySelector(".pinned-items-container");return l&&l!==this.pinnedContainerEl&&l.remove(),this.pinnedContainerEl=i.createDiv({cls:"pinned-items-container"}),i.insertBefore(this.pinnedContainerEl,i.firstChild),setTimeout(()=>{this.refreshPinnedItems()},100),!0}catch(e){return console.error("Failed to add pinned items to file explorer:",e),!1}}refreshPinnedItems(){try{if(!this.pinnedContainerEl||!this.pinnedContainerEl.isConnected){this.initializeWithRetry();return}if(this.pinnedContainerEl.empty(),this.plugin.settings.pinnedItems.length===0){this.pinnedContainerEl.remove(),this.pinnedContainerEl=null;return}this.pinnedContainerEl.style.display="block",this.pinnedContainerEl.style.visibility="visible",this.pinnedContainerEl.style.opacity="1",this.plugin.settings.pinnedItems.forEach(e=>{if(!this.pinnedContainerEl)return;let t=this.pinnedContainerEl.createDiv({cls:"pinned-item"});t.createSpan({cls:"pinned-item-icon",text:e.type==="folder"?"\u{1F4C1}":"\u{1F4C4}"}),t.createSpan({cls:"pinned-item-name",text:e.name});let n=l=>{l.preventDefault();let o=this.app.vault.getAbstractFileByPath(e.path);o?o instanceof p.TFile?this.app.workspace.getLeaf(!1).openFile(o):o instanceof p.TFolder&&new p.Notice(`Folder: ${o.path}`):(new p.Notice(`File not found: ${e.path}`),this.unpinItem(e.path))};this.plugin.registerDomEvent(t,"touchstart",n),this.plugin.registerDomEvent(t,"click",n);let i=t.createSpan({cls:"pinned-item-unpin",text:"\xD7"}),s=l=>{l.stopPropagation(),l.preventDefault(),this.unpinItem(e.path)};this.plugin.registerDomEvent(i,"touchstart",s),this.plugin.registerDomEvent(i,"click",s)})}catch(e){console.error("Failed to refresh pinned items:",e)}}};var c=require("obsidian");var u=require("obsidian");function m(r,e){let t=`${r.path}/${r.name}.md`,n=e.vault.getAbstractFileByPath(t);return n instanceof u.TFile?n:null}function y(r,e=!0){let t=0;for(let n of r.children)n instanceof u.TFile?t++:n instanceof u.TFolder&&e&&(t+=y(n,!0));return t}function f(r){return r.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&")}var E=class{constructor(e,t){this.app=e,this.plugin=t}initialize(){this.app.workspace.onLayoutReady(()=>{this.hideAllFolderNotesQuick(),setTimeout(()=>{this.updateAllFolderNotes()},50),setTimeout(()=>{this.updateAllFolderNotes()},200),setTimeout(()=>{this.updateAllFolderNotes()},500),setTimeout(()=>{this.updateAllFolderNotes()},1e3),setTimeout(()=>{this.updateAllFolderNotes()},2e3)}),this.plugin.registerEvent(this.app.vault.on("create",e=>{e instanceof c.TFile&&e.extension==="md"&&setTimeout(()=>{this.updateFolderNoteForFile(e)},100)})),this.plugin.registerEvent(this.app.vault.on("rename",(e,t)=>{e instanceof c.TFile&&e.extension==="md"&&setTimeout(()=>{this.updateFolderNoteForFile(e);let n=this.getParentFromPath(t);n&&this.updateFolderNote(n)},100)})),this.plugin.registerEvent(this.app.vault.on("delete",e=>{if(e instanceof c.TFile&&e.extension==="md"){let t=e.parent;t&&setTimeout(()=>{this.updateFolderNote(t)},100)}})),this.plugin.registerEvent(this.app.workspace.on("layout-change",()=>{this.hideAllFolderNotesQuick(),setTimeout(()=>{this.updateAllFolderNotes()},100),setTimeout(()=>{this.updateAllFolderNotes()},500)})),this.plugin.registerEvent(this.app.workspace.on("file-open",e=>{setTimeout(()=>{this.updateAllFolderNotes()},100)})),this.plugin.registerEvent(this.app.workspace.on("active-leaf-change",()=>{setTimeout(()=>{this.updateAllFolderNotes()},100)}))}getParentFromPath(e){let t=e.split("/");t.pop();let n=t.join("/");if(!n)return this.app.vault.getRoot();let i=this.app.vault.getAbstractFileByPath(n);return i instanceof c.TFolder?i:null}updateFolderNoteForFile(e){let t=e.parent;t&&this.updateFolderNote(t)}updateAllFolderNotes(){if(this.showAllHiddenFolderNotes(),!this.plugin.settings.showFolderNotes){this.removeAllFolderNoteStyles();return}this.getAllFolders().forEach(t=>this.updateFolderNote(t))}showAllHiddenFolderNotes(){let e=this.app.workspace.getLeavesOfType("file-explorer");if(!e||e.length===0)return;let n=e[0].view;if(!n.containerEl)return;n.containerEl.querySelectorAll(".is-folder-note-hidden").forEach(s=>{s.removeClass("is-folder-note-hidden")})}removeAllFolderNoteStyles(){let e=this.app.workspace.getLeavesOfType("file-explorer");if(!e||e.length===0)return;let n=e[0].view;if(!n.containerEl)return;n.containerEl.querySelectorAll(".nav-folder-title.has-folder-note").forEach(s=>{let l=s;l.removeClass("has-folder-note");let o=l.querySelector(".nav-folder-title-content");if(o){let h=o._folderNoteClickHandler;h&&(o.removeEventListener("click",h),delete o._folderNoteClickHandler)}})}hideAllFolderNotesQuick(){if(!this.plugin.settings.showFolderNotes)return;this.getAllFolders().forEach(t=>{let n=m(t,this.app);if(n){let i=this.getFileElement(n);i&&i.addClass("is-folder-note-hidden")}})}getAllFolders(){let e=[],t=n=>{e.push(n),n.children.forEach(i=>{i instanceof c.TFolder&&t(i)})};return t(this.app.vault.getRoot()),e}updateFolderNote(e){if(!this.plugin.settings.showFolderNotes)return;let t=m(e,this.app),n=this.getFolderElement(e);if(!n)return;let i=n.querySelector(".nav-folder-title-content"),s=i._folderNoteClickHandler;if(s&&(i.removeEventListener("click",s),delete i._folderNoteClickHandler),t){if(n.addClass("has-folder-note"),this.hideFolderNoteFile(t),i){let l=o=>{let h=o.target;if(h===i||h.classList.contains("nav-folder-title-content")){let x=document.createRange(),T=i.firstChild;if(T&&T.nodeType===Node.TEXT_NODE){x.selectNodeContents(T);let M=x.getBoundingClientRect(),A=o.clientX;A>=M.left&&A<=M.right&&(o.preventDefault(),o.stopPropagation(),this.app.workspace.getLeaf(!1).openFile(t))}}};i._folderNoteClickHandler=l,i.addEventListener("click",l)}}else n.removeClass("has-folder-note")}hideFolderNoteFile(e){let t=this.getFileElement(e);t&&t.addClass("is-folder-note-hidden")}getFileElement(e){let t=this.app.workspace.getLeavesOfType("file-explorer");if(!t||t.length===0)return null;let i=t[0].view;if(!i.containerEl)return null;let s=f(e.path),l=i.containerEl.querySelectorAll(`.nav-file-title[data-path="${s}"]`);return l.length>0?l[0].closest(".tree-item.nav-file"):null}getFolderElement(e){let t=this.app.workspace.getLeavesOfType("file-explorer");if(!t||t.length===0)return null;let i=t[0].view;if(!i.containerEl)return null;let s=f(e.path),l=i.containerEl.querySelectorAll(`.nav-folder-title[data-path="${s}"]`);return l.length>0?l[0]:null}addContextMenuItems(e,t){if(!this.plugin.settings.showFolderNotes)return;let n=m(t,this.app);n?e.addItem(i=>{i.setTitle("\u{1F4DD} Open folder note").setIcon("document").onClick(()=>{this.app.workspace.getLeaf(!1).openFile(n)})}):e.addItem(i=>{i.setTitle("\u{1F4DD} Create folder note").setIcon("document-create").onClick(async()=>{let s=`${t.path}/${t.name}.md`,l=await this.app.vault.create(s,`# ${t.name}

`);await this.app.workspace.getLeaf(!1).openFile(l)})})}};var d=require("obsidian");var F=class{constructor(e,t){this.app=e,this.plugin=t}initialize(){this.app.workspace.onLayoutReady(()=>{setTimeout(()=>{this.updateAllFileCounts()},300),setTimeout(()=>{this.updateAllFileCounts()},1e3),setTimeout(()=>{this.updateAllFileCounts()},2e3)}),this.plugin.registerEvent(this.app.workspace.on("layout-change",()=>{setTimeout(()=>{this.plugin.settings.showFileCount?this.addFileCountClass():this.removeFileCountClass()},100)})),this.plugin.registerEvent(this.app.vault.on("create",e=>{setTimeout(()=>{if(e instanceof d.TFile){let t=e.parent;t&&(this.updateFileCount(t),this.updateParentCounts(t))}else e instanceof d.TFolder&&(this.updateFileCount(e),e.parent&&this.updateParentCounts(e.parent))},100)})),this.plugin.registerEvent(this.app.vault.on("rename",(e,t)=>{setTimeout(()=>{if(e instanceof d.TFile){let n=e.parent;n&&(this.updateFileCount(n),this.updateParentCounts(n));let i=this.getParentFromPath(t);i&&(this.updateFileCount(i),this.updateParentCounts(i))}else e instanceof d.TFolder&&(this.updateFileCount(e),e.parent&&this.updateParentCounts(e.parent))},100)})),this.plugin.registerEvent(this.app.vault.on("delete",e=>{setTimeout(()=>{if(e instanceof d.TFile){let t=e.parent;t&&(this.updateFileCount(t),this.updateParentCounts(t))}else e instanceof d.TFolder&&e.parent&&(this.updateFileCount(e.parent),this.updateParentCounts(e.parent))},100)})),this.plugin.registerEvent(this.app.workspace.on("active-leaf-change",()=>{setTimeout(()=>{this.updateAllFileCounts()},200)}))}getParentFromPath(e){let t=e.split("/");t.pop();let n=t.join("/");if(!n)return this.app.vault.getRoot();let i=this.app.vault.getAbstractFileByPath(n);return i instanceof d.TFolder?i:null}updateParentCounts(e){let t=e.parent;for(;t;)this.updateFileCount(t),t=t.parent}updateAllFileCounts(){if(!this.plugin.settings.showFileCount){this.removeAllBadges(),this.removeFileCountClass();return}this.addFileCountClass(),this.getAllFolders().forEach(t=>{this.updateFileCount(t)})}removeAllBadges(){let e=this.app.workspace.getLeavesOfType("file-explorer");if(!e||e.length===0)return;let n=e[0].view;if(!n.containerEl)return;n.containerEl.querySelectorAll(".file-count-badge").forEach(s=>s.remove())}addFileCountClass(){let e=this.app.workspace.getLeavesOfType("file-explorer");if(!e||e.length===0)return;let n=e[0].view;n.containerEl&&n.containerEl.addClass("file-count-enabled")}removeFileCountClass(){let e=this.app.workspace.getLeavesOfType("file-explorer");if(!e||e.length===0)return;let n=e[0].view;n.containerEl&&n.containerEl.removeClass("file-count-enabled")}getAllFolders(){let e=[],t=n=>{e.push(n),n.children.forEach(i=>{i instanceof d.TFolder&&t(i)})};return t(this.app.vault.getRoot()),e}updateFileCount(e){if(!this.plugin.settings.showFileCount)return;let t=this.getFolderElement(e);if(!t)return;let n=t.querySelector(".file-count-badge");n&&n.remove();let i=y(e,!0);if(i>0){let s=createSpan({cls:"file-count-badge"});s.setText(`${i}`),s.setAttribute("aria-label",`${i} file(s) in this folder (including subfolders)`),t.appendChild(s)}}getFolderElement(e){let t=this.app.workspace.getLeavesOfType("file-explorer");if(!t||t.length===0)return null;let i=t[0].view;if(!i.containerEl)return null;let s=f(e.path),l=i.containerEl.querySelectorAll(`.nav-folder-title[data-path="${s}"]`);return l.length>0?l[0]:null}};var v=class extends a.Plugin{async onload(){await this.loadSettings(),this.pinnedItemsManager=new g(this.app,this),this.folderNoteManager=new E(this.app,this),this.fileCountManager=new F(this.app,this),this.pinnedItemsManager.initialize(),this.folderNoteManager.initialize(),this.fileCountManager.initialize(),this.registerEvent(this.app.workspace.on("file-menu",(t,n)=>{this.addContextMenuItems(t,n)})),this.addSettingTab(new w(this.app,this))}onunload(){this.pinnedItemsManager.cleanup()}addContextMenuItems(t,n){this.settings.pinnedItems.some(s=>s.path===n.path)?t.addItem(s=>{s.setTitle("\u{1F4CC} Unpin").setIcon("pin-off").onClick(async()=>{await this.pinnedItemsManager.unpinItem(n.path)})}):t.addItem(s=>{s.setTitle("\u{1F4CC} Pin to top").setIcon("pin").onClick(async()=>{await this.pinnedItemsManager.pinItem(n)})}),n instanceof a.TFolder&&this.folderNoteManager.addContextMenuItems(t,n)}async loadSettings(){this.settings=Object.assign({},P,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},w=class extends a.PluginSettingTab{constructor(t,n){super(t,n);this.plugin=n}display(){let{containerEl:t}=this;if(t.empty(),t.createEl("h2",{text:"File Explorer Enhancements"}),new a.Setting(t).setName("Show folder notes").setDesc("Show an indicator (\u{1F4DD}) next to folders that have a folder note (a markdown file with the same name as the folder).").addToggle(n=>n.setValue(this.plugin.settings.showFolderNotes).onChange(async i=>{this.plugin.settings.showFolderNotes=i,await this.plugin.saveSettings(),this.plugin.folderNoteManager.updateAllFolderNotes()})),new a.Setting(t).setName("Show file count").setDesc("Show the number of files in each folder. Displays as 'direct/total' where direct is the number of files directly in the folder and total includes subfolders.").addToggle(n=>n.setValue(this.plugin.settings.showFileCount).onChange(async i=>{this.plugin.settings.showFileCount=i,await this.plugin.saveSettings(),this.plugin.fileCountManager.updateAllFileCounts()})),t.createEl("h3",{text:"Pinned Items"}),new a.Setting(t).setName("Pin files and folders").setDesc("Right-click on any file or folder in the file explorer to pin it to the top for quick access."),this.plugin.settings.pinnedItems.length>0){t.createEl("h4",{text:"Currently pinned:"});let n=t.createEl("ul",{cls:"pinned-items-list"});this.plugin.settings.pinnedItems.forEach(i=>{let s=n.createEl("li");s.createSpan({text:`${i.type==="folder"?"\u{1F4C1}":"\u{1F4C4}"} ${i.path}`,cls:"pinned-item-path"}),s.createEl("button",{text:"Remove",cls:"pinned-item-remove-btn"}).addEventListener("click",async()=>{await this.plugin.pinnedItemsManager.unpinItem(i.path),this.display()})}),new a.Setting(t).setName("Clear all pinned items").setDesc("Remove all pinned items at once").addButton(i=>i.setButtonText("Clear all").setWarning().onClick(async()=>{this.plugin.settings.pinnedItems=[],await this.plugin.saveSettings(),this.plugin.pinnedItemsManager.refreshPinnedItems(),this.display()}))}else t.createEl("p",{text:"No items pinned yet. Right-click on any file or folder to pin it.",cls:"setting-item-description"})}};
